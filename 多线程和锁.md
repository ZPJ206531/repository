# 多线程并发

## 1.1 进程

进程是操作系统资源分配的基本单位，由程序、数据、进程控制块组成，能够获得操作系统分配的资源，参与操作系统的调度，CPU竞争等。

进程在创建、撤销和切换中，系统会为之付出较大的时空开销。

## 1.2 线程

线程是进程中的一个执行单位，是系统分配和调度的基本单位，即线程是CPU可执行调度的最小单位。

## 1.3 协程

协程是比线程更加轻量级的存在。一个线程可以有多个协程。执行过程类似于子例程，或者不带返回值的函数。

协程又被称为微线程。由开发人员确定上下文切换顺序。协程运行在线程之上，当一个协程执行完成之后，可以主动让出，让另一个协程，运行在当前线程上。

因此，在大量IO操作业务的情况下，采用协程替用线程，能够降低系统内存，减少系统切换开销，从而提高系统的性能。

## 2. 进程和线程的区别

- 地址空间
  进程拥有独立的地址空间，线程只能共享所属进程的地址空间。
- 资源
  进程之间的资源是独立的，方便操作系统进行资源管理和保护。线程则是共享所属进程的资源空间，例如内存、I/O、CPU等
- 健壮性
  由于进程之间相互独立，一个进程坏死不会导致其他进程死亡。但是一个线程崩溃，可能导致整个进程挂掉。
- 执行过程
  进程可以独立进行，有具体的程序入口、执行序列，且执行开销较大；线程不能独立执行，必须依附在应用程序中，执行开销比较小。
- 并发性
  进程和线程都能进行并发
- 切换开销（操作系统）
  在切换进程时，消耗的资源较大、有需要寄存器切换。线程切换消耗较小。
- 通信
  进程间通过SOCKET、共享内存、管道、信号量、消息队列、信号等进行交互。
  线程则是通过锁机制（互斥锁、条件变量、读写锁）、信号量、信号等机型交互。

| 对比维度       | 多进程                                        | 多线程                            |
| -------------- | --------------------------------------------- | --------------------------------- |
| 数据共享、同步 | 数据共享复杂，需要IPC；数据分开，同步简单     | 共享数据简单，不安全；同步复杂    |
| 内存、CPU      | 占用内存多，切换复杂，CPU利用率低（切换复杂） | 占用内存少，切换简单，CPU利用率高 |
| 创建销毁、切换 | 创建销毁、切换复杂                            | 创建销毁、切换简单                |
| 编程、调试     | 编程简单，调试简单                            | 编程复杂，调试复杂                |
| 可靠性         | 进程之间相互不会影响                          | 一个线程可能导致整个进程挂掉      |
| 分布式         | 适用于多核、多机分布式                        | 适用于多核分布式                  |



## 3. 协程和线程的区别

- 线程相对独立，由操作系统定制上下文，切换收到系统的控制
- 协程的切换上下文由开发人员确定，运行在线程之上。



# 锁

锁，主要是提供了访问保护作用，在C++中主要有以下五种锁

| 类名                           | 描述                             |
| ------------------------------ | -------------------------------- |
| std::mutex                     | 简单的互斥对象                   |
| std::timed_mutex               | 带有超时机制的护持对象           |
| std::recursive_mutex           | 允许被同一个线程递归使用         |
| std::recursive_temed_mutex     | 带有超时机制的递归互斥对象       |
| std::shared_timed_mutex(C++14) | 允许多个线程共享所有权的互斥对象 |

 ## std::mutex

互斥锁，主要操作对象有：加锁(lock)、解锁(unlock)。当一个线程对互斥对象进行加锁，即过得这个对象的所有权。在此线程对此对象进行解锁之前，其他线程都无法操作该对象。

另外，还有一种

